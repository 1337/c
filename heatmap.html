<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <style>
        #map {
            height: 100%;
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.5/lodash.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA0zWNUmciiHlaW3xgnCeZeYQjhkqrHft4&libraries=visualization"></script>
</head>
<body>
<div id="map"></div>
<script>
    var map, heatmap;

    var styledMapType = new google.maps.StyledMapType(
            [
                {
                    "elementType": "geometry",
                    "stylers": [
                        {
                            "color": "#f5f5f5"
                        }
                    ]
                },
                {
                    "elementType": "labels.icon",
                    "stylers": [
                        {
                            "visibility": "off"
                        }
                    ]
                },
                {
                    "elementType": "labels.text.fill",
                    "stylers": [
                        {
                            "color": "#616161"
                        }
                    ]
                },
                {
                    "elementType": "labels.text.stroke",
                    "stylers": [
                        {
                            "color": "#f5f5f5"
                        }
                    ]
                },
                {
                    "featureType": "administrative.land_parcel",
                    "elementType": "labels.text.fill",
                    "stylers": [
                        {
                            "color": "#bdbdbd"
                        }
                    ]
                },
                {
                    "featureType": "poi",
                    "elementType": "geometry",
                    "stylers": [
                        {
                            "color": "#eeeeee"
                        }
                    ]
                },
                {
                    "featureType": "poi",
                    "elementType": "labels.text.fill",
                    "stylers": [
                        {
                            "color": "#757575"
                        }
                    ]
                },
                {
                    "featureType": "poi.park",
                    "elementType": "geometry",
                    "stylers": [
                        {
                            "color": "#e5e5e5"
                        }
                    ]
                },
                {
                    "featureType": "poi.park",
                    "elementType": "labels.text.fill",
                    "stylers": [
                        {
                            "color": "#9e9e9e"
                        }
                    ]
                },
                {
                    "featureType": "road",
                    "elementType": "geometry",
                    "stylers": [
                        {
                            "color": "#ffffff"
                        }
                    ]
                },
                {
                    "featureType": "road.arterial",
                    "elementType": "labels.text.fill",
                    "stylers": [
                        {
                            "color": "#757575"
                        }
                    ]
                },
                {
                    "featureType": "road.highway",
                    "elementType": "geometry",
                    "stylers": [
                        {
                            "color": "#dadada"
                        }
                    ]
                },
                {
                    "featureType": "road.highway",
                    "elementType": "labels.text.fill",
                    "stylers": [
                        {
                            "color": "#616161"
                        }
                    ]
                },
                {
                    "featureType": "road.local",
                    "elementType": "labels.text.fill",
                    "stylers": [
                        {
                            "color": "#9e9e9e"
                        }
                    ]
                },
                {
                    "featureType": "transit.line",
                    "elementType": "geometry",
                    "stylers": [
                        {
                            "color": "#e5e5e5"
                        }
                    ]
                },
                {
                    "featureType": "transit.station",
                    "elementType": "geometry",
                    "stylers": [
                        {
                            "color": "#eeeeee"
                        }
                    ]
                },
                {
                    "featureType": "water",
                    "elementType": "geometry",
                    "stylers": [
                        {
                            "color": "#c9c9c9"
                        }
                    ]
                },
                {
                    "featureType": "water",
                    "elementType": "labels.text.fill",
                    "stylers": [
                        {
                            "color": "#9e9e9e"
                        }
                    ]
                }
            ]);


    function initMap(data) {
        map = new google.maps.Map(document.getElementById('map'), {
            zoom: 10,
            center: {lat: 43.4798, lng: -80.5222},
            mapTypeId: 'styled_map',
            mapTypeControlOptions: {
                mapTypeIds: [
                    'roadmap', 'satellite', 'hybrid', 'terrain',
                    'styled_map'
                ]
            }
        });

        map.mapTypes.set('styled_map', styledMapType);
        map.setMapTypeId('styled_map');


        heatmap = new google.maps.visualization.HeatmapLayer({
            data: data,
            map: map
        });
        heatmap.set('radius', 10);
        heatmap.set('opacity', 2.0);
    }

    fetch('location_history.txt').then(function (resp) {
        return resp.text();
    }).then(function (csvText) {
        var points = _.map(
                csvText.split('\n'),
                function (a) {
                    var csv = a.split(',');
                    return [
                        parseFloat(csv[2]),
                        parseFloat(csv[3])
                    ];
                });

        var ehhhh = _.compact(_.map(points, function (point) {
            var lat = point[0], lng = point[1];
            if (!(lat && lng)) {
                return null;
            }
            // filter out home1
            // 43.498174, -80.552445
            // 43.497765, -80.551975
            if (lat >= 43.497765 && lat <= 43.498174 && lng >= -80.552445 && lng <= -80.551975) {
                return null;
            }
            // filter out home2
            // 43.444071, -80.496492
            // 43.443621, -80.495497
            if (lat >= 43.443621 && lat <= 43.444071 && lng >= -80.496492 && lng <= -80.495497) {
                return null;
            }
            // filter out office1
            // 43.479964, -80.522594
            // 43.479450, -80.521807
            if (lat >= 43.479450 && lat <= 43.479964 && lng >= -80.522594 && lng <= -80.521807) {
                return null;
            }

            return new google.maps.LatLng(lat, lng);
        }));

        initMap(ehhhh);
    });
</script>
</body>
</html>
